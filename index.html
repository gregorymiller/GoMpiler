
<!DOCTYPE HTML>
<html>
<head>
    <title>GoMpiler</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="GoMpiler.css" />
</head>
<body onload="init();">
<h1>Gregory Miller's Compiler - GoMpiler (I am so clever it hurts)</h1>

<div>
    <div style="float:left; margin:0px 10px;">
        <h4>Source Code:</h4>
        <textarea id="taSourceCode" cols="64" rows="32"></textarea>
    </div>
    <div style="float:left; margin:0px 10px;">
        <h4>Compiler Output:</h4>
        <textarea id="taOutput" cols="64" rows="32"></textarea>
    </div>
</div>

<div style="margin-top:600px;">
    <input type="button" id="btnCompile" value="Compile" onclick="btnCompile_click();"/>
    <input type="checkbox" id="chkVerbose">Verbose Output
</div>

<!-- Client-side code down here, per the YSlow advice.
// (http://developer.yahoo.com/performance/rules.html#js_bottom) -->
<script type="text/javascript" src="Scripts/Utils.js"></script>
<script type="text/javascript" src="Scripts/Lexer.js"></script>
<script type="text/javascript" src="Scripts/TokenManager.js"></script>
<script type="text/javascript" src="Globals.js"></script>
<script type="text/javascript">

    function init()
    {
        // Clear the message box.
        document.getElementById("taOutput").value = "";
        // Set the initial values for our globals.
        _Tokens = [];
        _TokenIndex = 0;
        _CurrentToken = ' ';
        _ErrorCount = 0;
    }

    function btnCompile_click()
    {
        // This is executed as a result of the usr pressing the 
        // "compile" button between the two text areas, above.  
        // Note the <input> element's event handler: onclick="btnCompile_click();
        init();
        putMessage("Compilation Started");
        lex();

        putMessage("Lex returned [" + _Tokens + "]");
        // . . . and parse!
        parse();
    }




    function parse()
    {
        putMessage("Parsing [" + _Tokens + "]");
        // Grab the next token.
        _CurrentToken = getNextToken();
        // A valid parse derives the G(oal) production, so begin there.
        parseG();
        // Report the results.
        putMessage("Parsing found " + _ErrorCount + " error(s).");
    }

    function parseG()
    {
        // A G(oal) production can only be an E(xpression), so parse the E production.
        parseE();
    }

    function parseE()
    {
        // All E productions begin with a digit, so make sure that we have one.
        checkToken("digit");
        // Look ahead 1 char (which is now in _CurrentToken because checkToken
        // consumes another one) and see which E production to follow.
        if (_CurrentToken != EOF)
        {
            // We're not done, we we expect to have an op.
            checkToken("op");
            parseE();
        }
        else
        {
            // There is nothing else in the token stream, 
            // and that's cool since E --> digit is valid.
            putMessage("EOF reached");
        }
    }

    function checkToken(expectedKind)
    {
        // Validate that we have the expected token kind and et the next token.
        switch(expectedKind)
        {
            case "digit":   putMessage("Expecting a digit");
                if (_CurrentToken=="0" || _CurrentToken=="1" || _CurrentToken=="2" ||
                        _CurrentToken=="3" || _CurrentToken=="4" || _CurrentToken=="5" ||
                        _CurrentToken=="6" || _CurrentToken=="7" || _CurrentToken=="8" ||
                        _CurrentToken=="9")
                {
                    putMessage("Got a digit!");
                }
                else
                {
                    _ErrorCount++;
                    putMessage("NOT a digit.  Error at position " + _TokenIndex + ".");
                }
                break;
            case "op":      putMessage("Expecting an operator");
                if (_CurrentToken=="+" || _CurrentToken=="-")
                {
                    putMessage("Got an operator!");
                }
                else
                {
                    _ErrorCount++;
                    putMessage("NOT an operator.  Error at position " + _TokenIndex + ".");
                }
                break;
            default:        putMessage("Parse Error: Invalid Token Type at position " + _TokenIndex + ".");
                break;
        }
        // Consume another token, having just checked this one, because that 
        // will allow the code to see what's coming next... a sort of "look-ahead".
        _CurrentToken = getNextToken();
    }
</script>
</body>
</html>
